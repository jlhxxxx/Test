01

收集需求 分析需求 设计方案 设计用例
搭建环境 构造数据 配置监控 运行负载
记录结果 分析问题
给出调优
建议
多次测试
完成调优
生成报告

## 性能测试之需求分析

客户交流

* 响应时间

* 处理能力

*  资源占用率

* 负载量

    引导客户明确性能测试目标是解决问题的根本。

历史日志

* 最大峰值访问量

* 负载特性

* 行业规则

    举例：XXX公司需要新增一套流程管理系统，但不知道该系统在什么时候会出现性能问题？
    2012年日最大发起待办94598笔（含发起流程），假定在1小时内完成,
    每笔完成时间为5秒，则并发量为：94598*5/3600 =131。
    以每年20%的数据递增估算，5年后流程数量并发数：131 * 1.2 * 1.2 *
    1.2 * 1.2 * 1.2 = 325
    按照收入规模估算，广东5年后流程数量并发数预计为325 * 1.5 = 488
    按照收入规模估算，江苏、上海合并部署，5年后流程数量并发数预计为
    325 * 1.8 = 585

同类产品

* 物理特征
* 最大负载量
* 系统性能状态

80/20

* 核心业务
* 核心负载时间
* 经验

性能需求的关键在于
– 知道测什么
– 知道被测对象是什么
– 知道被测对象以后会被怎么用
– 知道我应该怎么测*
– 知道我测出来的结果怎么算通过



## 性能测试之设计方案
– 能不能测?
– 怎么测?
– 测试计划
– 测试方案
– 测试场景
– 测试流程
– 测试数据

• 做到想测就测的关键是分析：
–被测对象是一个基于网络的应用还是一个单机应用
–被测对象是如何实现负载的
–如何伪造数据流
–何种工具最适合做这种数据流伪造



计划和方案需要明确的信息：

• 系统真实环境平台的架构及软硬件标准
• 需要进行性能测试的模块及对应案例
• 脚本开发中可能需要解决的技术
• 业务完成与否的判断依据
• 相关信息的监控策略
• 场景模型的定义
• 对系统负载后的结果预估

 测试计划内容
– 文档目的
– 项目背景
– 相关术语
– 输入文档
– 运行环境
– 测试内容
– 角色安排
– 工具及进度安排
– 输出内容

编写测试方案
–测试目的
–测试策略

* 每一轮测试的重点
    –测试内容
    –性能测试的关注点
    –确定性能可能的瓶颈
    –平台对比
    –稳定性或压力测试

–测试准备流程
–测试脚本
–负载模型定义
–监控定义
–场景设定



测试方案评审

## 性能测试之测试准备

物理环境

软件环境

测试数据

**环境偏差**

• 由于客观原因大多数情况并无法活动和实
际情况1:1的测试环境
–通过评估建模来解决应用型扩展
–通过数学建模来解决物理扩展
• 容量规划的测试评估
–表示层和应用层的比例
–应用层和数据库层的比例



测试数据决定了性能测试结果
– 在需求中需要明确负载下的数据量
– 为系统构造有效的负载数据
• 手动
• 导入
• 自动（执行，SQL，数据生成工具PowerDesigner • DataFactory）



**设计场景**
• 目标型场景
–确定需求是否满足
• 手工场景
–Real world
• 压力测试
–Basic
• 手工调优



监控

 监控决定了性能测试中能收集到得信息数量
• 监控会降低性能负载
• 监控应该是运维做的事情
• 常用监控工具
– Nmon
– Spotlight
– DynaTrace
– ANTS
– Devparter
– Jprobe



Linux监控

CPU：就像人的大脑，主要负责相关事情的判断以
及实际处理的机制。
查询指令：cat /proc/cpuinfo
内存：大脑中的记忆区块，将皮肤、眼睛等所收集
到的信息记录起来的地方，以供CPU进行判断。
查询指令：cat /proc/meminfo
硬盘：大脑中的记忆区块，将重要的数据记录起来
，以便未来再次使用这些数据。
查询指令：fdisk -l (需要root权限)

#iostat –x
Linux 2.6.18-238.el5 (localhost.localdomain) 01/17/2012
avg-cpu:%user %nice %system %iowait %steal %idle
0.36 0.01 0.65 1.21 0.00 97.78
Device:rrqm/s wrqm/s r/s w/s rsec/s wsec/s avgrq-sz avgqu-sz await svctm %util
sda 26.02 6.80 11.13 7.31 1114.25 112.79 66.55 0.15 8.35 2.66 4.90
sda1 3.03 0.00 0.24 0.01 6.59 0.03 25.87 0.00 2.71 2.61 0.07
sda2 22.93 6.80 10.84 7.29 1106.74 112.76 67.27 0.15 8.46 2.67 4.84
dm-0 0.00 0.00 32.70 14.10 1102.70 112.76 25.97 0.35 7.38 1.02 4.79
dm-1 0.00 0.00 0.41 0.00 3.26 0.00 8.00 0.00 6.55 0.94 0.04

